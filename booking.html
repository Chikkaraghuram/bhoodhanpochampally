<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Booking - Ikat Sarees</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-orange-100 via-yellow-100 to-yellow-200 text-gray-800 font-sans">

  <!-- Navbar -->
  <header class="bg-white bg-opacity-80 shadow-lg p-4">
    <div class="container mx-auto flex justify-between items-center">
      <img src="logo.jpg" alt="Narsimha Sarees" class="w-20 h-20 object-cover rounded-lg shadow-md border-2 border-pink-400">
      <h1 class="text-2xl font-bold text-pink-700">Welcome</h1>
      <nav class="space-x-4">
        <a href="home.html" class="text-gray-700 hover:text-pink-600 font-semibold">Home</a>
      </nav>
    </div>
  </header>

  <!-- Booking Form -->
  <div class="max-w-lg mx-auto bg-white rounded-lg shadow-lg p-6 mt-10">
    <h2 class="text-xl font-bold text-pink-700 mb-4 text-center">Booking Details</h2>

    <!-- Product Preview -->
    <div id="productInfo" class="mb-4 text-center"></div>

    <form id="bookingForm" class="space-y-4">
      <input type="text" id="name" placeholder="Full Name" class="w-full border border-gray-300 rounded p-2" required>
      <input type="tel" id="phone" placeholder="Phone Number" maxlength="10" pattern="[0-9]{10}" class="w-full border border-gray-300 rounded p-2" required>
      <input type="number" id="quantity" placeholder="Quantity" min="1" value="1" class="w-full border border-gray-300 rounded p-2" required>

      <textarea id="address" placeholder="Street Address" class="w-full border border-gray-300 rounded p-2" rows="2" required></textarea>
      <input type="text" id="city" placeholder="City" class="w-full border border-gray-300 rounded p-2" required>
      <input type="text" id="district" placeholder="District" class="w-full border border-gray-300 rounded p-2" required>
      <input type="text" id="state" placeholder="State" class="w-full border border-gray-300 rounded p-2" required>
      <input type="text" id="country" placeholder="Country" class="w-full border border-gray-300 rounded p-2" value="India" required>
      <input type="text" id="pincode" placeholder="Pincode" maxlength="6" pattern="[0-9]{6}" class="w-full border border-gray-300 rounded p-2" required>

      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition font-semibold">Next</button>
    </form>
  </div>

  <script>
    // Load product info
    const product = JSON.parse(localStorage.getItem("selectedProduct"));
    if (product) {
      document.getElementById("productInfo").innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="mx-auto w-40 h-40 object-cover rounded-lg mb-2 shadow">
        <h3 class="font-bold">${product.name}</h3>
        <p class="text-pink-600 font-semibold">₹${product.price}</p>
      `;
    } else {
      document.getElementById("productInfo").innerHTML = `<p class="text-red-500">No product selected.</p>`;
    }

    // Save booking data for logged-in user
    document.getElementById("bookingForm").addEventListener("submit", function (e) {
      e.preventDefault();

      let currentUser = localStorage.getItem("currentUser");
      if (!currentUser) {
        alert("Please log in first!");
        return;
      }

      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const quantity = parseInt(document.getElementById("quantity").value);
      const address = document.getElementById("address").value;
      const city = document.getElementById("city").value;
      const district = document.getElementById("district").value;
      const state = document.getElementById("state").value;
      const country = document.getElementById("country").value;
      const pincode = document.getElementById("pincode").value;
      const totalPrice = quantity * product.price;

      // Create order object
      let newOrder = {
        id: Date.now(),
        name: product.name,
        price: product.price,   // ✅ store per piece price
        quantity: quantity,     // ✅ store quantity
        totalPrice: totalPrice, // ✅ store total price
        image: product.image,
        date: new Date(),
        expectedDate: new Date(new Date().setDate(new Date().getDate() + 7)),
        deliveryDate: null,
        status: "Shipped",
        statusClass: "bg-yellow-100 text-yellow-800",
        customerName: name,
        phone,
        address,
        city,
        district,
        state,
        country,
        pincode
      };
      // Save order for the logged-in user
      let ordersKey = `orders_${currentUser}`;
      let orders = JSON.parse(localStorage.getItem(ordersKey)) || [];
      orders.push(newOrder);
      localStorage.setItem(ordersKey, JSON.stringify(orders));

      // Store booking details for payment page
      localStorage.setItem("bookingDetails", JSON.stringify(newOrder));

      // Go to payment page
      window.location.href = "payment.html";
    });
  </script>
</body>
</html>
